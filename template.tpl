___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Segment",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Make Segment api calls from Google Tag Manager.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "call",
    "displayName": "Call",
    "categories": ["ANALYTICS", "TAG_MANAGEMENT"],
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "track",
        "displayValue": "track"
      },
      {
        "value": "page",
        "displayValue": "page"
      },
      {
        "value": "identify",
        "displayValue": "identify"
      }
    ],
    "simpleValueType": true,
    "help": "Select which Segment API call you want to make."
  },
  {
    "type": "SELECT",
    "name": "useObjectAction",
    "displayName": "Use object action",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": true,
        "displayValue": "True"
      },
      {
        "value": false,
        "displayValue": "False"
      }
    ],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "call",
        "paramValue": "track",
        "type": "EQUALS"
      }
    ],
    "defaultValue": true,
    "help": "Select whether or not you are using the Object-Action framework as a naming convention. If selected, enter separate Object and Action values to create the track call\u0027s event name. The Object and Action will also be included as seperate properties in the track call."
  },
  {
    "type": "SELECT",
    "name": "userId",
    "displayName": "User id",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "spec",
        "paramValue": "identify",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "event",
    "displayName": "Event",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "useObjectAction",
        "paramValue": false,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "object",
    "displayName": "Object",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "useObjectAction",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "action",
    "displayName": "Action",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "useObjectAction",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "defaultProperties",
    "displayName": "Default properties or traits",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "call",
        "paramValue": "load",
        "type": "NOT_EQUALS"
      }
    ],
    "help": "Select a json object variable that you want add as default properties or traits that will be included with every track or identify call."
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "customProperties",
    "displayName": "Custom properties or traits",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Key",
        "name": "key",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Value",
        "name": "value",
        "type": "TEXT"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "call",
        "paramValue": "load",
        "type": "NOT_EQUALS"
      }
    ],
    "help": "Add any custom properties or traits that you want to include with the track or identify call specific to this tag."
  },
  {
    "type": "SELECT",
    "name": "suppressGa",
    "displayName": "Suppress Google Analytics",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": false,
        "displayValue": "False"
      },
      {
        "value": true,
        "displayValue": "True"
      }
    ],
    "simpleValueType": true,
    "help": "Select true to prevent the identify call from being sent to GA. Set to true if the User ID is an email address",
    "enablingConditions": [
      {
        "paramName": "call",
        "paramValue": "identify",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here.
const log = require('logToConsole');
const JSON = require('JSON');
const callInWindow = require('callInWindow');
const copyFromWindow = require('copyFromWindow');
const customProperties = data.customProperties;
const call = data.call;
const properties = {};
if (customProperties){
  for (var i=0; i<customProperties.length; i++){
    var property = customProperties[i];
    properties[property.key] = property.value;
  }
}
const defaultProperties = data.defaultProperties;
for (var attrname in defaultProperties) { properties[attrname] = defaultProperties[attrname]; }
if (call === "track"){
  let event = data.event;
  if (data.useObjectAction){
    event = data.object + " " + data.action;
    properties.category = data.object;
    properties.object = data.object;
    properties.action = data.action;
  }
  callInWindow('analytics.track', event, properties);
}
if (call === "page"){
  callInWindow('analytics.page', properties);
}
if (call === "identify"){
  const userId = data.userId;
  let suppressGa;
  if (data.suppressGa == "true" || data.suppressGa == true){
    suppressGa = true;
  }
  else{
    suppressGa = false;
  }
  const options = {
    integrations: {
          All: true,
          "Google Analytics": suppressGa == false
        }
  };
  callInWindow('analytics.identify', userId, properties, options);
}


data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics.track"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics.page"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics.identify"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Untitled test 1
  code: |-
    const mockData = {
      // Mocked field values
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 12/16/2021, 12:11:57 PM


